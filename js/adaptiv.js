
let quizDataLevelA = [
    {
        question: "कवि धरती के किन सपूतों को पुकारता है?",
        options: ["सैनिकों को", "किसान सपूतों को", "अमर सपूतों को", "बच्चों को"],
        answer: 2
    },
    {
        question: "कविता में ‘नव निर्माण’ का अर्थ है –",
        options: ["नया खाना बनाना", "नई इमारत बनाना", "समाज का पुनर्निर्माण करना", "नई सड़क बनाना"],
        answer: 2
    },
    {
        question: "‘उठो’ शब्द से कवि क्या करना चाहता है?",
        options: ["जगाना", "सुलाना", "डराना", "चुप कराना"],
        answer: 0
    },
    {
        question: "‘नव प्रात’ का अर्थ है –",
        options: ["नया गाँव", "नई सुबह", "नया जीवन", "नया काम"],
        answer: 1
    },
    {
        question: "‘नव’ शब्द का अर्थ क्या है?",
        options: ["पुराना", "रंगीन", "नया", "अधूरा"],
        answer: 2
    },
    {
        question: "‘नई स्मृति’ से कवि का क्या तात्पर्य है?",
        options: ["पुरानी यादें", "नई यादें", "किताबें", "फिल्में"],
        answer: 1
    },
    {
        question: "‘नव प्राण भरो’ का क्या अर्थ है?",
        options: ["नया भोजन", "नई ऊर्जा भरना", "नींद लेना", "अभ्यास करना"],
        answer: 1
    },
    {
        question: "कविता में मुस्कान भरने की बात कही गई है-",
        options: ["कवि की", "माता की", "पृथ्वी की", "युग-युग के सपनों में"],
        answer: 3
    },
    {
        question: "कविता का स्वर कैसा है?",
        options: ["दुखी", "प्रेरणादायक", "क्रोधित", "डरावना"],
        answer: 1
    },
    {
        question: "कविता के अंत में कवि क्या दोहराता है?",
        options: ["नई यादें बनाओ", "नई सोच लाओ", "पुन: नया निर्माण करो", "घर चलो"],
        answer: 2
    }
];

let quizDataLevelB = [
    {
        question: "‘नव किरण है, ज्योति नई’ पंक्ति का क्या तात्पर्य है?",
        options: ["नया दीपक जलाना", "प्रकाश और आशा का संदेश", "बिजली का उपयोग", "सूर्य का अस्त होना"],
        answer: 1
    },
    {
        question: "‘जन-जन के जीवन में -",
        options: ["जीवन को फिर से कठिन बनाना", "पुनः ऊर्जा भरना", "जीवन समाप्त करना", "जीवन से ऊब जाना"],
        answer: 1
    },
    {
        question: "‘नई उमंग, नई तरंग’ का अर्थ है-",
        options: ["डर", "क्रोध", "उत्साह और ऊर्जा", "आलस्य"],
        answer: 2
    },
    {
        question: "‘नव स्मृति’ और ‘नव प्राण’ किनका प्रतीक हैं?",
        options: ["अतीत का", "पुनरुत्थान और जागरूकता का", "नींद और आराम का", "दुःख और पीड़ा का"],
        answer: 1
    },
    {
        question: "‘पुन: नया निर्माण करो’ कविता में कितनी बार आया है?",
        options: ["एक बार", "दो बार", "तीन बार", "चार बार"],
        answer: 1
    },
    {
        question: "कविता में ‘साँस नई’ का अर्थ क्या है?",
        options: ["नई हवा", "नया जीवन व आत्मविश्वास", "साँस की दवा", "साँस लेना"],
        answer: 1
    },
    {
        question: "कविता का मुख्य उद्देश्य क्या है?",
        options: ["मनोरंजन करना", "शिक्षा देना", "देश के विकास हेतु प्रेरित करना", "दुख बताना"],
        answer: 2
    },
    {
        question: "‘नई-नई मुस्कान भरो’ से क्या संकेत मिलता है?",
        options: ["लोगों को हँसाना", "सकारात्मक सोच फैलाना", "मजाक करना", "कविता सुनाना"],
        answer: 1
    },
    {
        question: "‘युग-युग के’ शब्द का क्या अर्थ है?",
        options: ["आज के लिए", "आने वाली पीढ़ियों के लिए", "एक ही समय के लिए", "रात के लिए"],
        answer: 1
    },
    {
        question: "कविता के किस भाव ने इसे प्रेरणास्पद बनाया है?",
        options: ["क्रोध", "डर", "पुनर्निर्माण और आशा", "विरोध"],
        answer: 2
    }
];

let quizDataLevelC = [
    {
        question: "कविता में प्रयुक्त शैली कौन-सी है?",
        options: ["वर्णनात्मक", "प्रश्नोत्तरी", "आवाहनात्मक", "व्यंग्यात्मक"],
        answer: 2
    },
    {
        question: "‘धरती के अमर सपूतों’ में ‘अमर’ विशेषण का प्रयोग क्यों हुआ है?",
        options: ["क्योंकि वे मृत्यु से अजेय हैं", "क्योंकि वे प्रेरणास्रोत हैं", "क्योंकि वे युद्ध करते हैं", "क्योंकि वे भगवान हैं"],
        answer: 1
    },
    {
        question: "‘सपनों में मुस्कान’ डालने का क्या तात्पर्य है?",
        options: ["नींद में हँसना", "भविष्य के सपनों को सुंदर बनाना", "सोते समय सपना देखना", "झूठे सपने दिखाना"],
        answer: 1
    },
    {
        question: "‘नई बात’ से कवि का आशय है-",
        options: ["नई कहानी", "नवीन सोच व विचारधारा", "नई योजना", "अफवाह"],
        answer: 1
    },
    {
        question: "कवि के अनुसार हर बालक क्या है?",
        options: ["शिक्षक और छात्र", "रक्षक और पुजारी", "सैनिक और राजकुमार", "कलाकार और कवि"],
        answer: 1
    },
    {
        question: "इस कविता की संरचना किस प्रकार की है?",
        options: ["दोहा", "छंद मुक्त कविता", "चौपाई", "गीत"],
        answer: 1
    },
    {
        question: "‘नई-नई मुस्कान’ किसका प्रतीक है?",
        options: ["हास्य का", "नया जीवन व प्रसन्नता का", "उदासी का", "कार्यभार का"],
        answer: 1
    },
    {
        question: "कविता की पंक्तियों में कौन-सा काल प्रमुख है?",
        options: ["भूतकाल", "वर्तमान", "भविष्य", "मिश्रित काल"],
        answer: 2
    },
    {
        question: "‘पुनः’ शब्द के प्रयोग से कवि क्या दिखाना चाहता है?",
        options: ["एक बार प्रयास काफी है", "बार-बार प्रयास ज़रूरी है", "एक बार हार मान लो", "पुराना काफी है"],
        answer: 1
    },
    {
        question: "इस कविता से हमें कौन-सा नैतिक सन्देश मिलता है?",
        options: ["केवल अपने लिए जियो", "सब कुछ भगवान पर छोड़ दो", "समाज के नव निर्माण के लिए आगे आओ", "संघर्ष मत करो"],
        answer: 2
    }
];

// ------------------------ Global Variables ------------------------
let currentLevel = 1;
let currentQuizData = quizDataLevelA;
let currentQuestion = 0;
let submitted = false;
let attemptCount = 0;
let showResultPending = false;
let userAnswersAdaptiv = new Array(currentQuizData.length).fill(null);

document.getElementById("total-questions").textContent = currentQuizData.length;

const levelHeadings = {
    1: "1",
    2: "2",
    3: "3"
};

// ------------------------ Functions ------------------------
function renderQuestion(index, direction) {
    const q = currentQuizData[index];
    const container = document.getElementById("quizContainerAdaptiv");

    // Remove previous animation classes
    container.classList.remove('animate__fadeInDown', 'animate__fadeInUp');

    // Add animation based on direction
    if (direction === 'next') {
        container.classList.add('animate__animated', 'animate__fadeInDown');
    } else if (direction === 'prev') {
        container.classList.add('animate__animated', 'animate__fadeInUp');
    } else {
        container.classList.add('animate__animated', 'animate__fadeInDown'); // default
    }

    // Force reflow to restart animation
    void container.offsetWidth;

    // Render question
    container.innerHTML = `         
        <div class="row m-0" style="font-size:18px">
            <div style="width:30px" class="questionHeadingMCQ"><strong>Q${index + 1}. </strong></div>
            <div class="col questionHeadingMCQ">${q.question}</div>
        </div>
        <div class="row mt-3">
            <div class="row mt-2 ml-4">
            ${q.options.map((opt, i) => {
        const optionLabel = String.fromCharCode(65 + i);
        const isSelected = userAnswersAdaptiv[index] === i;
        let extraClass = isSelected ? "selected" : "";
        if (submitted) {
            if (i === q.answer) extraClass = "correct";
            else if (isSelected && i !== q.answer) extraClass = "incorrect";
        }
        return `        
                    <div class="col-md-6 col-sm-12 mb-2">
                        <label class="option-btnAdpt ${extraClass}" onclick="selectOption(${index}, ${i})">
                            <input type="radio" name="question-${index}" ${isSelected ? "checked" : ""}>
                            <strong>${optionLabel}.</strong> ${opt}
                        </label>
                    </div>
                    `;
    }).join('')
        }
            </div>
        </div>
    `;
    updateNavButtons();
}

function selectOption(qIndex, optIndex) {
    if (submitted) return;
    userAnswersAdaptiv[qIndex] = optIndex;
    updateAttemptedCount();
    if (userAnswersAdaptiv.filter(a => a !== null).length === currentQuizData.length && currentQuestion === currentQuizData.length - 1) {
        showResultPending = true;
    }
}

function nextQuestion() {
    // Check if user selected an option
    if (userAnswersAdaptiv[currentQuestion] === null || userAnswersAdaptiv[currentQuestion] === undefined) {
        Swal.fire({
            title: "Info",
            text: "Please select an option before next.",
            icon: "info"
        });
        return;
    }
    if (currentQuestion < currentQuizData.length - 1) {
        currentQuestion++;
        renderQuestion(currentQuestion, 'next');
    }
    updateNavButtons();
}

function prevQuestion() {
    if (currentQuestion > 0) {
        currentQuestion--;
        renderQuestion(currentQuestion, 'prev');
    }
    updateNavButtons();
}

function updateNavButtons() {
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const subBtn = document.getElementById("sub-btn");
    const isLast = currentQuestion === currentQuizData.length - 1;
    const allAnswered = userAnswersAdaptiv.every(ans => ans !== null);

    prevBtn.style.display = currentQuestion === 0 ? 'none' : 'inline-block';

    if (isLast && allAnswered) {
        nextBtn.style.display = 'none';
        subBtn.style.display = 'inline-block';
    } else {
        nextBtn.style.display = 'inline-block';
        subBtn.style.display = 'none';
    }
}

function showResult() {
    $("#levelText").hide();
    const container = document.getElementById("quizContainerAdaptiv");
    submitted = true;
    attemptCount++;
    const correct = userAnswersAdaptiv.filter((a, i) => a === currentQuizData[i].answer).length;
    const showAnswerBtn = attemptCount >= 5;
    const showRetryBtn = correct < currentQuizData.length;
    const showNextLevel = correct === currentQuizData.length;
    const finished = currentLevel === 3;
    const whenCompleteLevel = showNextLevel ? "completed." : "";
    document.getElementById("nav-buttons").style.display = "none";
    document.getElementById("submit-btn-wrapper").innerHTML = '';
    container.innerHTML = `
        <div class="result-box">
          <h4><strong class="fs-1">Level ${currentLevel} ${whenCompleteLevel}</strong></h4>
          <p class="text-danger my-3">Total Questions: ${currentQuizData.length}</p>
          <p class="text-success my-3">Correct Answers: ${correct}</p>
          <p class="text-success my-3">Attempt No: ${attemptCount}</p>
            <div class="rowBtns">
          ${showNextLevel ? `<button class='btn btn-success mt-3 mx-3' id='hideNxtLevel' onclick='loadNextLevel()'>Go To Level ${currentLevel + 1}</button>` : ''}
          ${(showRetryBtn || showNextLevel) ? `<button class='btn btn-primary mt-3 mx-3' onclick='retryQuiz()'>दोबारा प्रयास करें</button>` : ''}
          ${(showAnswerBtn || showNextLevel) ? `<button class='btn btn-danger mt-3 mx-3' onclick='showAnswerPopup()'>Show Answers</button>` : ''}
          ${(finished && showNextLevel) ? `<button class='btn btn-success mt-3 mx-3' onclick="finishMessage()">Finished</button>` : ''}
          </div>

        </div>`;
    showResultPending = false;
    $(".instruc").hide();
    $(".submit-info").hide();
    if (finished && showNextLevel) {
        $("#hideNxtLevel").hide();
    } else {
        $("#hideNxtLevel").show();
    }
}

function loadNextLevel() {
    $("#levelText").show();
    currentLevel++;
    if (currentLevel === 2) currentQuizData = quizDataLevelB;
    if (currentLevel === 3) currentQuizData = quizDataLevelC;
    currentQuestion = 0;
    submitted = false;
    userAnswersAdaptiv = new Array(currentQuizData.length).fill(null);
    attemptCount = 0;
    document.getElementById("nav-buttons").style.display = "block";
    document.querySelector(".levelUpdate").textContent = levelHeadings[currentLevel];
    renderQuestion(currentQuestion);
    updateAttemptedCount();
    $(".instruc").show();
    $(".submit-info").show();
    if (currentLevel === 2) {
        $("#quizContainerAdaptiv").removeClass("animate__bounceInLeft").addClass("animate__bounceInRight");
    }
    else if (currentLevel === 3) {
        $("#quizContainerAdaptiv").removeClass("animate__bounceInRight").addClass("animate__bounceInLeft");
    }
    document.getElementById("nav-buttons").style.display = "block";
}

function updateAttemptedCount() {
    const attempted = userAnswersAdaptiv.filter(a => a !== null).length;
    document.getElementById("attempted-count").textContent = attempted;
}

function retryQuiz() {
    currentQuestion = 0;
    submitted = false;
    userAnswersAdaptiv = new Array(currentQuizData.length).fill(null);
    attemptCount = 0;
    document.getElementById("nav-buttons").style.display = "flex";
    renderQuestion(currentQuestion);
    updateAttemptedCount();
    $(".instruc").show();
    $(".submit-info").show();
    $("#levelText").show();
    document.getElementById("nav-buttons").style.display = "block";
}

function showAnswerPopup() {
    let totalCorrect = 0;
    let totalQuestion = 0;
    let topData = ``;
    let midData1 = ``;
    let midData2 = ``;
    let midData3 = ``;
    let midData4 = ``;
    let midData5 = ``;
    let endData = ``;
    const review = currentQuizData.map((q, i) => {
        const optionLabel = index => String.fromCharCode(65 + index);
        const userIndex = userAnswersAdaptiv[i];
        const userAnswerText = userIndex !== null ? `${optionLabel(userIndex)}. ${q.options[userIndex]}` : "Not attempted";
        const correctAnswerText = `${optionLabel(q.answer)}. ${q.options[q.answer]}`;
        const allOptions = q.options.map((opt, idx) => `${optionLabel(idx)}. ${opt}`).join('<br>');
        if (userAnswerText == correctAnswerText) {
            totalCorrect++;
        }
        totalQuestion++;

        midData2 += `<tr clsss="trData">
         <th>Q${totalQuestion}.</th>
         <td class="text-danger">${optionLabel(userIndex)}. ${q.options[userIndex]}</td>
         <td class="text-success">${optionLabel(q.answer)}. ${q.options[q.answer]}</td>
         <td class="text-danger ">${userAnswerText === correctAnswerText ? '✔' : '✘'}</td>
      </tr>`;
    }).join('');

    topData = `<div class="d-flex justify-content-between align-items-center">
                  <h4 id="scoreTextQ1" class="text-center mb-3">You got : ${totalCorrect} out of ${totalQuestion}</h4>
                  <button class="btn btn-secondary" onclick="closeFnAD()">X</button>
               </div>`;
    midData1 = `<div id="" class="innerDIV">
                  <div class="table-responsive p-2">
                     <table class="table table-bordered" style="font-size:20px">
                     <thead class="thead-light" style="white-space: nowrap;">
                        <tr>
                           <th>Ques. No.</th>
                           <th>Your Answer</th>
                           <th>Correct Answer</th>
                           <th>Status</th>
                        </tr>
                     </thead>
                     <tbody>`;
    midData3 = `</tbody>
                     </table>
                  </div>
               </div>`;
    document.getElementById("answer-reviewAD").innerHTML = topData + midData1 + midData2 + midData3;

    $("#popupDialogAnsAd").css("display", "block")

}

function closeFnAD() {
    $("#popupDialogAnsAd").hide();
}

function popupFn() {
    $("#overlay,#popupDialog").show();
}

const finishMessage = () => {
    Swal.fire({
        title: "All level has been completed.",
        text: "",
        icon: "success",
        timer: 3000,
        showConfirmButton: false
    });
}

// Initial render
renderQuestion(currentQuestion);

function openFn() {
    document.getElementById('overlay').classList.add('active');
}

function closeFn() {
    document.getElementById('overlay').classList.remove('active');
}

